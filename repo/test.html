<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Página de Prueba de Función</title>
</head>
<body>
    <h1>Página de Prueba</h1>
    <p>Abre la consola (F12) y haz clic en el botón para probar la función.</p>
    <button id="testButton">Probar Función 'testAuth'</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAKnJXo7QLcU7jxkhar_-WeLJNHtxXG9Bk",
            authDomain: "kluppy-duelos.firebaseapp.com",
            projectId: "kluppy-duelos",
            storageBucket: "kluppy-duelos.appspot.com",
            messagingSenderId: "221783859909",
            appId: "1:221783859909:web:504d021f4e50a11c8486ac",
            measurementId: "G-0839SL8VP6"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const functions = getFunctions(app, 'us-central1');

        // Botón de prueba
        const btn = document.getElementById('testButton');
        btn.textContent = "Generar Texto con IA";

        // Iniciamos sesión anónimamente para estar autenticados
        signInAnonymously(auth).then(() => {
            console.log("Usuario anónimo autenticado.");

            btn.onclick = async () => {
                console.log("Llamando a la Cloud Function 'generateExerciseText'...");
                btn.disabled = true;
                btn.textContent = "Generando...";

                const generateText = httpsCallable(functions, 'generateExerciseText');

                try {
                    // El prompt que le pedimos a la IA
                    const result = await generateText({ 
                        prompt: "Un texto de unas 30 palabras sobre la historia de la informática, enfocado en las teclas E-R-T-U-I-O" 
                    });

                    console.log("✅ ¡Texto generado con éxito!");
                    console.log(result.data.exerciseText);
                    document.body.innerHTML += `<p style="margin-top: 20px; border: 1px solid #ccc; padding: 10px;">${result.data.exerciseText}</p>`;

                } catch (error) {
                    console.error("❌ Error al llamar a la función:", error);
                } finally {
                    btn.disabled = false;
                    btn.textContent = "Generar Texto con IA";
                }
            };
        }).catch(err => console.error("Error en login anónimo", err));
    </script>
</body>
</html>