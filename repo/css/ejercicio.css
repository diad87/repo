/* --- IMPORTACIONES Y FUENTES --- */
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');

        @font-face {
            font-family: 'Coolvetica';
            src: url('../fonts/coolvetica-rg-webfont.woff2') format('woff2'),
                url('../fonts/coolvetica-rg-webfont.woff') format('woff');
            font-weight: 400; font-style: normal;
        }
        @font-face {
            font-family: 'Coolvetica Heavy';
            src: url('../fonts/coolvetica-heavy-webfont.woff2') format('woff2'),
                url('../fonts/coolvetica-heavy-webfont.woff') format('woff');
            font-weight: 900; font-style: normal;
        }

        /* --- PALETA DE COLORES (VARIABLES CSS) --- */
        /* Tema Claro (por defecto) */
        :root {
            --color-bg: #f3f4f6;
            --color-bg-rgb: 243, 244, 246;
            --color-text: #111827;
            --color-surface: #ffffff;
            --color-surface-accent: #e5e7eb;
            --color-border: #d1d5db;
            --color-primary: #0891b2;
            --color-success: #10b981;
            --color-cursor-bg: rgba(17, 24, 39, 0.2);
        }
        /* Tema Oscuro (ajustado para parecerse a tu versión preferida) */
        body.dark-theme {
            --color-bg: #1f2937;
            --color-bg-rgb: 31, 41, 55;
            --color-text: #d1d5db; /* Color de texto de las teclas del original */
            --color-surface: #111827; /* Fondo del teclado del original */
            --color-surface-accent: #374151; /* Color de tecla del original */
            --color-border: #374151;
            --color-primary: #22d3ee;
            --color-cursor-bg: rgba(255, 255, 255, 0.2);
        }

        /* --- ESTILOS GENERALES --- */
        body { 
            font-family: 'Coolvetica', sans-serif; 
            background-color: var(--color-bg);
            color: var(--color-text);
        }
        .font-coolvetica-heavy { font-family: 'Coolvetica Heavy', sans-serif; }
        #test-mecanografia { max-width: 1000px; margin: auto; text-align: center; }
        
        #sample-container {
            position: relative; overflow: hidden; white-space: nowrap; width: 100%;
            height: 6rem; display: flex; align-items: center; margin-bottom: 2rem;
            background-color: var(--color-surface);
            border-radius: 0.75rem; border: 1px solid var(--color-border);
        }
        #texto-muestra {
            position: relative; font-size: 2rem; user-select: none;
            transition: transform 0.15s ease-out;
            font-family: 'Fira Code', monospace;
            color: var(--color-text); 
        }
        #progress-container, #progress-bar, #progress-text {
            /* Estilos de la barra de progreso como los querías (fijos) */
            position: relative;
        }
        #progress-container { width: 100%; height: 20px; background: var(--color-surface-accent); margin-bottom: 2.5rem; border-radius: 9999px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background-color: #10b981; transition: width 0.2s; position: absolute; top:0; left:0; }
        #progress-text { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #111827; font-weight: bold; }
        
        #entrada-usuario { position: absolute; width: 1px; height: 1px; opacity: 0; left: -9999px; }
        
        /* --- TECLADO (CON EL ESTILO ORIGINAL INTEGRADO) --- */
        #keyboard-container { 
            position: relative; display: inline-block; padding: 1rem;
            background-color: var(--color-surface);
            border-radius: 0.75rem; border: 1px solid var(--color-border); width: 100%;
        }
        .keyboard-row { margin: 6px 0; display: flex; justify-content: center; gap: 6px; }
        .key {
            height: 55px; flex-grow: 1; flex-basis: 0;
            display: flex; align-items: center; justify-content: center;
            border-bottom: 3px solid rgba(0,0,0,0.4); border-radius: 8px;
            background-color: var(--color-surface-accent);
            color: var(--color-text);
            font-size: 1rem; user-select: none; position: relative;
            transition: all 0.1s ease;
        }
        
        /* Colores de aprendizaje (siempre fijos) */
        .key[data-key-group="group-1"] { background-color: #9EF0B0; color: #1a202c;}
        .key[data-key-group="group-2"] { background-color: #9CEB7A; color: #1a202c;}
        .key[data-key-group="group-3"] { background-color: #FAED64; color: #1a202c;}
        .key[data-key-group="group-4"] { background-color: #EDB656; color: #1a202c;}
        .key[data-key-group="group-5"] { background-color: #A668C4; color: white; }
        .key[data-key-group="group-6"] { background-color: #7EC2F5; color: #1a202c;}

        /* --- SISTEMA DE RESALTADO (BASADO EN TU VERSIÓN PREFERIDA) --- */
        /* Resaltado general para ambos temas (el del original) */
        /* .key.highlight {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.4);
            border-color: #fff;
        } */
        /* Efecto de atenuación SÓLO para el modo oscuro */
        /* body.dark-theme #keyboard-container.foco-activo .key {
            opacity: 0.4;
            transition: opacity 0.3s ease-in-out;
        }
        body.dark-theme #keyboard-container.foco-activo .key.highlight {
            opacity: 1;
        } */
         /* 1. Preparamos una "capa/velo" invisible. La usaremos SOLO en el modo oscuro. */
        .key::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            /*background-color: rgba(0, 0, 0, 0.5); /* Velo oscuro para el modo oscuro */
            opacity: 0; /* Por defecto, la capa es invisible */
            transition: opacity 0.3s ease-in-out;
            border-radius: inherit; /* Hereda el redondeo de la tecla */
            pointer-events: none;
        }

        /* 2. Resaltado para MODO CLARO */
        /* La tecla se oscurece para contrastar (efecto inversión) */
        body:not(.dark-theme) .key.highlight {
            background-color: rgba(0, 0, 0, 0.35);/*var(--color-text); /* Fondo oscuro */
            /*color: var(--color-bg);             /* Texto claro */
            border-color: var(--color-text);
            transform: scale(1.1);
        }

        /* 3. Efecto de Foco para MODO OSCURO */
        /* Cuando el foco está activo, mostramos el "velo" en las teclas inactivas */
        body.dark-theme #keyboard-container.foco-activo .key::before {
            background-color: rgba(0, 0, 0, 0.35);
            opacity: 1;
        }

        /* Y en la tecla activa del modo oscuro, la hacemos resaltar y nos aseguramos de que no tenga el velo */
        body.dark-theme #keyboard-container.foco-activo .key.highlight {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5); /* Le añadimos un brillo blanco */
            opacity: 1; /* Nos aseguramos de que sea 100% opaca */
        }
        body.dark-theme #keyboard-container.foco-activo .key.highlight::before {
            opacity: 0; /* Ocultamos el velo solo para esta tecla */
        }

        /* --- ESTILOS DE COMPONENTES Y ANIMACIONES --- */
        #hands-container { margin-top: 2rem; width: 100%; max-width: 450px; margin-left: auto; margin-right: auto; }
        .hand-finger { fill: var(--color-surface-accent); transition: fill 0.2s ease-in-out; }
        
        @keyframes shake { 10%, 90% { transform: translateX(-1px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }
        .shake { animation: shake 0.5s ease-in-out; }
        
        #results-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(var(--color-bg-rgb), 0.8);
            backdrop-filter: blur(5px);
            display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-content {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 28rem;
        }
        .star { display: inline-block; opacity: 0; transform: scale(0.5); animation: starPop 0.8s forwards; }
        @keyframes starPop { 0% { opacity: 0; transform: scale(0.5) rotate(0deg); } 50% { opacity: 1; transform: scale(1.3) rotate(15deg); } 100% { opacity: 1; transform: scale(1) rotate(0deg); } }

        #live-stats-container {
            /* Posicionamiento y Apariencia */
            position: fixed; /* Fijo en la pantalla */
            top: 8rem;
            right: 1.5rem;
            z-index: 1000;
            /* Usamos las variables para que el color se adapte al tema */
            background-color: rgba(var(--color-surface-rgb), 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid var(--color-border);
            border-radius: 0.5rem;
            padding: 1rem;
            width: 250px;
            cursor: grab;

            /* Lógica para Ocultar/Mostrar con animación */
            visibility: hidden;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Clase para mostrar el panel */
        #live-stats-container.is-open {
            visibility: visible;
            opacity: 1;
            transform: translateX(0);
        }

        /* Estilos de los items internos, usando variables */
        .stats-title {
            font-size: 1rem;
            font-weight: bold;
            color: var(--color-text);
            text-align: center;
            padding-bottom: 0.5rem;
        }
        .stats-divider {
            height: 1px;
            background-color: var(--color-border);
            margin-bottom: 0.5rem;
            width: 100%;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
            align-items: baseline;
        }
        .stat-label {
            font-size: 0.8rem;
            color: var(--color-text);
            opacity: 0.7;
        }
        .stat-value {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--color-text);
        }
        /* Colores específicos para ciertas estadísticas */
        #live-corrections { color: #facc15; } /* Amarillo para correcciones */
        #live-top-errors { color: #f87171; }  /* Rojo para errores */
        
        #music-toggle-button {
            position: fixed; bottom: 1rem; right: 1rem; z-index: 1001;
            background: rgba(var(--color-surface-rgb), 0.7);
            backdrop-filter: blur(5px); border-radius: 50%; width: 50px; height: 50px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; cursor: pointer; transition: all 0.2s ease;
        }
        #music-toggle-button:hover { transform: scale(1.1); }
        
        #theme-toggle {
            background-color: #4b5563;
            position: relative;
            display: inline-flex;
            align-items: center;
            height: 1.75rem; /* 28px, un poco más alto para que quepa bien */
            width: 3.25rem;  /* 52px, un poco más ancho */
            border-radius: 9999px;
            padding: 0.25rem; /* 4px de espacio interior */
            transition: background-color 0.2s ease-in-out;
        }

        #theme-toggle-indicator {
            position: absolute;
            display: inline-block;
            width: 1.25rem;  /* 20px */
            height: 1.25rem; /* 20px */
            transform: translateX(0);
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s ease-in-out;
        }

        body.dark-theme #theme-toggle {
            background-color: var(--color-primary);
        }

        /* Movemos la bolita la distancia correcta: Ancho total - Ancho bolita - (2 * padding) */
        /* 52px - 20px - 8px = 24px = 1.5rem */
        body.dark-theme #theme-toggle-indicator {
            transform: translateX(1.5rem); 
        }

        #intervention-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }

        #intervention-modal.visible #intervention-box {
            opacity: 1;
            transform: scale(1);
        }

        #graceful-exit-modal.visible {
            opacity: 1 !important;
            pointer-events: auto !important;
        }

        #graceful-exit-modal.visible #graceful-exit-box {
            opacity: 1 !important;
            transform: scale(1) !important;
        }
        
        #loading-spinner {
            position: absolute;
            left: 50%;
            top: 50%;
            /* Centramos el spinner perfectamente en el contenedor */
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid #4b5563; /* Color del borde gris oscuro */
            border-top-color: #22d3ee; /* Color cian para la parte que gira */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Animación que hace girar el spinner */
        @keyframes spin {
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }